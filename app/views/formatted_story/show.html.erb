<%= raw @header %>
<tw-storydata name="<%= @story.name %>" startnode="<%= @startpid %>" creator="Passages" creator-version="0" ifid="<%= @story.try(:ifid) %>" zoom="1" format="<%= @story.story_format.name %>" format-version="<%= @story.story_format.version %>" options="" hidden>
<style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css"><%= @story.try(:stylesheet) %></style>
<script role="script" id="twine-user-script" type="text/twine-javascript"><%= @story.try(:script) %></script>
<% @story.story_passages.order('sequence asc').each do |s_passage| %>
<tw-passagedata pid="<%= s_passage.sequence
 %>" name="<%= s_passage.passage.title
 %>" tags="<%= s_passage.tags
 %>" position="<%= s_passage.position
 %>" size="<%= s_passage.size %>">
<%= raw CGI::escapeHTML(s_passage.passage.body.to_s)  #[34..-15] Skip ActionText's leading and trailing div tags
%>
</tw-passagedata>
<% end %>
</tw-storydata>
<%= raw @footer %>
